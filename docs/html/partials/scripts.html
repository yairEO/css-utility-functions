<script>
  // Update active sidebar link on scroll
  const sections = document.querySelectorAll('.function-section');
  const sidebarLinks = document.querySelectorAll('.sidebar nav a[data-function]');

  function updateActiveLink() {
    const scrollPos = window.scrollY + 200;

    sections.forEach((section, index) => {
      const top = section.offsetTop;
      const bottom = top + section.offsetHeight;
      const id = section.getAttribute('id');

      if (scrollPos >= top && scrollPos < bottom) {
        sidebarLinks.forEach(link => link.classList.remove('active'));
        const activeLink = document.querySelector(`.sidebar nav a[href="#${id}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }
    });
  }

  window.addEventListener('scroll', updateActiveLink);
  window.addEventListener('load', updateActiveLink);

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });

  // Interactive demo handlers
  document.querySelectorAll('[data-demo]').forEach(demo => {
    const type = demo.getAttribute('data-demo');

    if (type === 'alpha') {
      const slider = demo.querySelector('input[type="range"]');
      const colorInput = demo.querySelector('input[type="color"]');
      const box = demo.querySelector('.color-demo');

      if (slider && colorInput && box) {
        const updateAlpha = () => {
          const opacity = slider.value;
          const color = colorInput.value;
          box.style.backgroundColor = `oklch(from ${color} l c h / ${opacity})`;
          demo.querySelector('.value-display').textContent = `Opacity: ${opacity}`;
        };

        slider.addEventListener('input', updateAlpha);
        colorInput.addEventListener('input', updateAlpha);
        updateAlpha();
      }
    }
  });
</script>
